<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>BASIL/Tutorial</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="fsl/css/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="fsl/css/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="fsl/css/print.css">
<style type="text/css">
ul.pagetitle{
  display: inline;
  margin: 0;
  padding: 0;
  font-size: 1.5em;
}
li.pagetitle{
  display: inline;
  margin: 0;
}
td.noborder {
  border: 0;
}
</style>
</head>
<body>
<table>
<tr>
<td class="noborder">
<img src="logo.png">
</td>
<td class="noborder">
<ul class="pagetitle">
<li class="pagetitle"><a class="backlink">BASIL/Tutorial</a>
</ul>
<br><br>
[<a href="FSL.html">FSL</a>]&nbsp;[<a href="TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="WordIndex.html">WordIndex</a>]&nbsp;
</td>
</tr>
</table>
<hr>
<div id="page">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867"><div class="FslToolContents">
<h1>Contents</h1>
<ol><li><a href="./BASIL.html">Introduction</a></li><li><a href="./BASIL(2f)UserGuide.html">User Guide</a></li><li>Tutorial<div class="contentslist"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#Introduction">Introduction</a></li><li>
<a href="#DATASET_1:_pulsed_ASL">DATASET 1: pulsed ASL</a><ol><li>
<a href="#Exercise_1.1:_CBF_estimation">Exercise 1.1: CBF estimation</a></li><li>
<a href="#Exercise_1.2:_CBF_estimation_with_a_macro_vascular_component">Exercise 1.2: CBF estimation with a macro vascular component</a></li></ol></li><li>
<a href="#DATASET_2:_pseudo_continuous_ASL">DATASET 2: pseudo continuous ASL</a><ol><li>
<a href="#Exercise_2.1:_Tag-control_subtraction">Exercise 2.1: Tag-control subtraction</a></li><li>
<a href="#Exercise_2.2:_CBF_estimation">Exercise 2.2: CBF estimation</a></li></ol></li><li>
<a href="#DATASET_3:_QUASAR">DATASET 3: QUASAR</a><ol><li>
<a href="#Exercise_3.1:_Model-based_analysis">Exercise 3.1: Model-based analysis</a></li><li>
<a href="#Exercise_3.2:_Model-free_analysis">Exercise 3.2: Model-free analysis</a></li></ol></li><li>
<a href="#Acknowledgments">Acknowledgments</a></li></ol></div></div></li><li><a href="./BASIL(2f)FurtherInformation.html">Further Information</a></li></ol></div> <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867">
<h1 id="Introduction">Introduction</h1>
<span class="anchor" id="line-6"></span><p class="line862">This tutorial runs through the use of <tt class="backtick">oxford_asl</tt> (the command line tool) on a number of different multi-TI ASL datasets.The data can be found here (~50 MB) <span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span><ul><li><p class="line891"><a class="attachment" href="attachments/BASIL(2f)Tutorial/basildata.zip" title="">basildata.zip</a> <span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span></li></ul><p class="line874">Please note that the data is only provided for training purposes and should not be used for research without permission. <span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-13"></span>
<h1 id="DATASET_1:_pulsed_ASL">DATASET 1: pulsed ASL</h1>
<span class="anchor" id="line-14"></span><p class="line862">This dataset is resting-state ASL data collected using a single-shot three-dimensional GRASE readout, TR/TE 3110/23 ms, 3.44x3.44x5mm, 22 slices using a matrix size 64x64, FAIR preparation, background suppression. Alternating control and tag pairs were acquired with 10 TIs (400, 620, 840, 1060, 1280, 1500, 1720, 1940, 2160, 2380 ms), each one repeated 10 times. The data is in the directory <tt class="backtick">data_pasl</tt>. <span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span><p class="line862">In this case the tag-control subtraction has already been done and the multiple measurements at each TI have been averaged, this has been put in the file <tt class="backtick">diffdata.nii.gz</tt>. (In a later exercise we will see how that was done). Have a look at the differenced data using FSLview: <span class="anchor" id="line-17"></span><span class="anchor" id="line-18"></span><p class="line867"><span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span><pre><span class="anchor" id="line-1"></span>fslview pasl_data/diffdata &amp;</pre><span class="anchor" id="line-21"></span><p class="line874">You might like to flick through the different volumes and see if you can spot the label washing in and then decaying away again. Notice that the label arrives in some regions later than others. <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line867">
<h2 id="Exercise_1.1:_CBF_estimation">Exercise 1.1: CBF estimation</h2>
<span class="anchor" id="line-24"></span><p class="line874">Firstly we are going to do the model-fitting. Try typing this in your terminal <span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><p class="line867"><span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span><pre><span class="anchor" id="line-1-1"></span>oxford_asl</pre><span class="anchor" id="line-29"></span><p class="line862">If you call <tt class="backtick">oxford_asl</tt> without any options you get the usage information. There is a lot of functionality (and we do not want to use all of it now), the three main things it can do are: model-fitting, registration and calibration. We need to do model-fitting to get CBF from the multi-TI data, so we will need: <span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><ul><li>The tag-control differenced ASL data - we have this already. <span class="anchor" id="line-32"></span></li><li>The TIs that were used to acquire the data - 0.4,0.62,0.84,1.06,1.28,1.5,1.72,1.94,2.16,2.38. <span class="anchor" id="line-33"></span></li><li>The duration of the ASL bolus - the acquisition was FAIR, so the bolus duration is determined by the labelling coil (body). In fact the bolus duration for this data is around 1.1 s, so we will use that value, but allow the model fitting to refine that estimate (this is automatically done by oxford_asl unless we tell it otherwise). <span class="anchor" id="line-34"></span></li><li>A starting guess for the bolus arrival time - we will take the default of 0.7 s, we dont need to be very precise as the model-fitting should work this out for us. <span class="anchor" id="line-35"></span></li><li>Values of T1 and T1b for the field strength we used - data was aquired at 3T so use T1 of 1.3 s and T1b of 1.6 s. <span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span></li></ul><p class="line874">We have all the information we need so all we have to do is run this command (check you understand what each bit does): <span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><p class="line867"><span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><pre><span class="anchor" id="line-1-2"></span>oxford_asl -i data_pasl/diffdata --tis 0.4,0.62,0.84,1.06,1.28,1.5,1.72,1.94,2.16,2.38 -o ex1_1 --bolus 1.1 --bat 0.7 --t1 1.3 --t1b 1.66 --artoff --spatial</pre><span class="anchor" id="line-42"></span><p class="line862">Notice that we have turned off the estimation of the macrovascular component (<tt class="backtick">--artoff</tt>), we will come back to this. We are using the 'spatial' mode, which is recommened as it exploits the natural spatial smoothness of the estimated CBF image. <span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><p class="line862">In the results directory, <tt class="backtick">ex1_1</tt>, you will find a <tt class="backtick">native_space</tt> directory that contains all the estimated images at the same resolution as the original data. You should find in there (and look at using FSLview): <span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><ul><li><p class="line891"><tt class="backtick">perfusion.nii.gz</tt> The estimated CBF image in the same (arbitrary) units as the original data. <span class="anchor" id="line-47"></span></li><li><p class="line891"><tt class="backtick">arrival.nii.gz</tt> The estimated bolus arrival time image (in seconds). <span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span></li></ul><p class="line874">Since we would like the estimated CBF in physiological units (ml/100g/min) we also need: <span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><ul><li>Calibration data - we have aslcalib.nii.gz which was acquired using the same readout but no inversion and no background suppression. <span class="anchor" id="line-52"></span></li><li>A reference 'tissue' - in this case we are going to use CSF as our reference (yes it isn't actually a 'tissue'). <span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span></li></ul><p class="line867"><tt class="backtick">oxford_asl</tt> will, if given a structural image, try to automatically segment out the ventricles and use these as a CSF reference for calibration. We want a slightly quicker result, so there is a previously defined CSF mask, <tt class="backtick">csfmask.nii.gz</tt>, to use. In this case there was a difference in the gain of a factor of 10 used when acquiring the calibration data (no background suppression) and the main ASL data (with background suppression). <span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><p class="line874">Run the command again but with the extra calibration information supplied: <span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><p class="line867"><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><pre><span class="anchor" id="line-1-3"></span>oxford_asl -i data_pasl/diffdata --tis 0.4,0.62,0.84,1.06,1.28,1.5,1.72,1.94,2.16,2.38 -o ex1_1 --bolus 1.1 --bat 0.7 --t1 1.3 --t1b 1.66 --artoff --spatial -c pasl_data/aslcalib --csf pasl_data/csfmask --cgain 10</pre><span class="anchor" id="line-61"></span><p class="line862">You should now find in the results directory an extra image: <tt class="backtick">perfusion_calib.nii.gz</tt>, which is the estimated CBF image in ml/100g/min having used the separate calibration information. You should also find a <tt class="backtick">calib</tt> subdirectory that includes the results of the calibration process, the main one being <tt class="backtick">M0.txt</tt> that contains the estimated equilibrium magnetization of arterial blood (in scanner units). This M0 value was used to scale the perfusion image to get it into physiological units. <span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><p class="line867">
<h2 id="Exercise_1.2:_CBF_estimation_with_a_macro_vascular_component">Exercise 1.2: CBF estimation with a macro vascular component</h2>
<span class="anchor" id="line-64"></span><p class="line874">In the previous exercise we only fit a tissue based kinetic curve to the data. However, the data was not aquired with flow supression so there should be a substantial contirbution from ASL label still within larger vessels. What we should do, therefore, is to add a macro vascular component to account for this: <span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><p class="line867"><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><pre><span class="anchor" id="line-1-4"></span>oxford_asl -i data_pasl/diffdata -c aslcalib --csf csfmask --tis 0.4,0.62,0.84,1.06,1.28,1.5,1.72,1.94,2.16,2.38 -o ex1_2 --bolus 1.1 --bat 0.7 --t1 1.3 --t1b 1.66 --spatial</pre><span class="anchor" id="line-69"></span><p class="line862">Notice that we have run exactly the same command as the previous exercise, we have just removed <tt class="backtick">--artoff</tt>. By default <tt class="backtick">oxford_asl</tt> always fits the macro vascualr component, even with flow suppression some arterial label can still be present. <span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><p class="line862">In the results directory, <tt class="backtick">ex1_2</tt>, you will find the perfusion and arrival results again, along with an image called <tt class="backtick">aCBV.nii.gz</tt>, this is the estimated arterial cerebral blood volume image from the macro vascular component. Compare the images from this exercise with the previous one. Notice that the CBF is lower and arrival time is later where the magntiude of the aCBV image is large - around regions where large vessels would be expected. <span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><p class="line867">
<h1 id="DATASET_2:_pseudo_continuous_ASL">DATASET 2: pseudo continuous ASL</h1>
<span class="anchor" id="line-76"></span><p class="line874">This dataset is resting-state pcASL data collected using an EPI readout, TR/TE 3750/14 ms, 3.75x3.75x7.5mm, 24 slices using a matrix size 64x64. Alternating control and tag pairs were acquired after 1.4 s of labelling at 5 different post labelling delays (200, 400, 600, 800, 1000 ms), each one repeated 12 times. The data is in the directory pcasl_data <span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><p class="line874">We are going to need to know what the inversion times were for each measurement. For pASL this was the time between labelling and readout. For cASL we need the time from the start of labelling to readout, so our TI = labelling duration + post labelling delay. Thus the TIs are: 1.6, 1.8, 2.0, 2.2, 2.4 s. <span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><p class="line867">
<h2 id="Exercise_2.1:_Tag-control_subtraction">Exercise 2.1: Tag-control subtraction</h2>
<span class="anchor" id="line-81"></span><p class="line862">The first thing we need to do is take the raw ASL data and do tag-control subtraction to remove the static tissue contribution. We are also going to take the average of the multiple measurements at each TI to make the model-fitting faster (in practice would could skip this as <tt class="backtick">oxford_asl&nbsp;could&nbsp;do&nbsp;this&nbsp;for&nbsp;us</tt>). We could split the data into separate volumes and do subtraction and averaging of these images before re-assembling it all together, but that would be tedious! Instead we have a command that knows how to deal with ASL data, what we want to do is: <span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><p class="line867"><span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><pre><span class="anchor" id="line-1-5"></span>asl_file --data=data_pcasl/asl_raw_data --ntis=5 --ibf=rpt --iaf=tc --diff --mean=pcasl_diffdata</pre><span class="anchor" id="line-86"></span><p class="line862">The command tells <tt class="backtick">asl_file</tt>: <span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><ul><li>Where to find the data. <span class="anchor" id="line-89"></span></li><li>How many TIs there are in the file. <span class="anchor" id="line-90"></span></li><li>That the data contains repeated measurements (where we have cycled through all the TIs each time). <span class="anchor" id="line-91"></span></li><li>That the data is in tag-control pairs. <span class="anchor" id="line-92"></span></li><li>That we want to do pairwise subtraction. <span class="anchor" id="line-93"></span></li><li><p class="line862">That it should take the mean of each TI and save that as the output file in the current directory: <tt class="backtick">pcasl_diffdata</tt>. <span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span></li></ul><p class="line862">Have a look at the data (<tt class="backtick">pcasl_diffdata</tt>) in <tt class="backtick">FSLview</tt> as we did for the pASL data. This set will look a bit different as we only have 5 TIs and these are all placed so that they will be near the peak of the kinetic curve. So we dont see the nice clear wash in of the label as we did before. <span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><p class="line867">
<h2 id="Exercise_2.2:_CBF_estimation">Exercise 2.2: CBF estimation</h2>
<span class="anchor" id="line-98"></span><p class="line874">We will do CBF estimation in a very similar way to the pASL data. However, this time we will: <span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><ul><li><p class="line862">Use a cASL model with the <tt class="backtick">--casl</tt> option. <span class="anchor" id="line-101"></span></li><li><p class="line862">Set the bolus duration to 1.4 s - the length of labeling. Since the cASL label is well defined we wont try to estimate its duration, so we add the <tt class="backtick">--fixbolus</tt> option. <span class="anchor" id="line-102"></span></li><li><p class="line862">Supply a structural image, which means that <tt class="backtick">oxford_asl</tt> will try to register the ASL data to the structural image and give the CBF results in the same space at the structural. By default <tt class="backtick">oxford_asl</tt> will try to register the estimated CBF image to the structural, this can be problematic as there may not be excellent contrast for this. The raw ASL data is a much better basis for registration so we will instruct <tt class="backtick">oxford_asl</tt> to use this with the <tt class="backtick">--regfrom</tt> commmand. <span class="anchor" id="line-103"></span></li><li><p class="line862">Not supply a CSF mask. We will let <tt class="backtick">oxford_asl</tt> automatically identify the CSF using the structural image. <span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span></li></ul><p class="line874">The full command we need is (again see if you can identify what each term does): <span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><p class="line867"><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><pre><span class="anchor" id="line-1-6"></span>oxford_asl -i pcasl_diffdata -c data_pcasl/calibration_head --tis 1.6,1.8,2.0,2.2,2.4 -o ex2_2 --bolus 1.4 --bat 0.7 --t1 1.3 --t1b 1.66 --artoff --fixbolus --spatial --casl -s data_pcasl/struc --regfrom data_pcasl/asl_raw_data</pre><span class="anchor" id="line-110"></span><p class="line862">In the results directory, <tt class="backtick">ex2_2</tt>, you will find a <tt class="backtick">native_space</tt> set of results, but also the same results at the resolution of the structural image (<tt class="backtick">struct_space</tt>). As with the pASL results there are perfusion and bolus arrival time images. Since we only have 5 tightly spaced TIs we wont expect our arrival time images to be as good. You will also notice from the arrival time image that the mask generated by oxford_asl wasn't perfect - it includes all the brain, but some non brain too. We could have made our own mask and supplied it to oxford_asl with the <tt class="backtick">-m</tt> option if we had wanted to. It is also worth looking at <tt class="backtick">ex2_2/calib/refmask.nii.gz</tt> as this is the mask that was used to indentify the CSF in the calibration image, you should check that it looks like voxels within the ventricles have been indentified. <span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><p class="line874">When we analysed the pASL data we also added a macro vascular component into the model. However, we wont do that here since all the TIs we have come quite late and we are likely to have missed most of the early arriving arterial based label. <span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><p class="line867">
<h1 id="DATASET_3:_QUASAR">DATASET 3: QUASAR</h1>
<span class="anchor" id="line-117"></span><p class="line862">The QUASAR variant of ASL makes use of a combination of flow suppressed and non suppressed multi-TI data to allow for a better separation of the tissue and macro vascular signals. This aids model-based analysis and also permits 'model-free' analysis similar to that used in DSC-MRI. QUASAR data also has all the information within it to do the calibration step. Because the QUASAR sequence is well defined we dont have to worry about all the options in <tt class="backtick">oxford_asl</tt>, in fact there is a special version specifcally desgined for QUASAR data called <tt class="backtick">quasil</tt>. Again just trying the command brings up the usage - there are not many options this time! <span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><p class="line867">
<h2 id="Exercise_3.1:_Model-based_analysis">Exercise 3.1: Model-based analysis</h2>
<span class="anchor" id="line-120"></span><p class="line874">Firstly we are going to do a model-based analysis, just like we did in exercise 2, but tailored for QUASAR data. The command we want is: <span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><p class="line867"><span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><pre><span class="anchor" id="line-1-7"></span>quasil -i data_quasar/data -o ex3_1</pre><span class="anchor" id="line-125"></span><p class="line874">In the results directory, ex3_1, you should find perfusion and aCBV images to examine. <span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span><p class="line867">
<h2 id="Exercise_3.2:_Model-free_analysis">Exercise 3.2: Model-free analysis</h2>
<span class="anchor" id="line-128"></span><p class="line862">Now we are going to compare the model-based results with numerical deconvolution (this is the method proposed in Petersen's original paper). <tt class="backtick">quasil</tt> will also do this using the <tt class="backtick">--mfree</tt> option: <span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><p class="line867"><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><pre><span class="anchor" id="line-1-8"></span>quasil -i data_quasar/data -o ex3_2 --mfree</pre><span class="anchor" id="line-133"></span><p class="line874">Like the model-based analysis both perfusion and aCBV images are produced. Compare the model-based and model-free results, you should find that the model-free perfusion values are generally lower than the model-based results, primiarly due to the underestimation of the numerical deconvolution. <span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><p class="line867">
<h1 id="Acknowledgments">Acknowledgments</h1>
<span class="anchor" id="line-138"></span><p class="line862">Thanks are due to Brad <a class="nonexistent" href="./MacIntosh.html">MacIntosh</a>, Dan Gallichan, Michael Kelly, Esben Petersen and Xavier Golay for the provision of the ASL data used in these exercises. <span class="anchor" id="line-139"></span><span class="anchor" id="bottom"></span></div>
</div>
<hr>
2012-09-05 11:30
</body>
</html>

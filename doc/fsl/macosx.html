<!DOCTYPE html
PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type"
content="text/html;charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../fsl.css" />
<link rel="stylesheet" type="text/css" href="install.css" />
<title>FSL</title></head><body>

<IFRAME width="100%" scrolling="no" frameborder="0" src="top.html">Broken</IFRAME>

<h1>Installing FSL on Apple Mac</h1>
<p>
Thanks to Robert Coghill for sponsoring the Apple port.
</p>
<p>Contents:</p>
<ul>
<li><a href="#prereq">Prerequisites</a></li>
<li><a href="#autoinst">FSL install script</a></li>
<li><a href="#maninst">Manual installation</a></li>
<li><a href="#checkinst">Checking the installation</a></li>
<li><a href="#gui">Running the GUIs</a></li>
<li><a href="#matlab">Using Matlab Libraries</a></li>
<li><a href="#fhelp">Further help</a></li>
</ul>
<hr /><a id="prereq"></a><h2>Prerequisites</h2>
<p>Before you install FSL you should first ensure that you have the X11 windowing system installed. To do this, look for the X11 application in the Utilities folder within the Applications folder (switch to the Finder and hit Apple-Shift-U to open the Utilities folder); by default Macs don't generally come with this installed (you'll almost certainly need X11 later for things other than FSL anyway.)
</p>
<p>If you do not have X11 then install it from the OS X Install CD. Insert the CD, open it in the Finder, scroll down to the Optional Installs package and double click to launch the installer. Click through until the custom install window appears, expose the Applications section and select X11. Now click on 'Install'</p>
<div class="centred">
      <table class="centred">
      <tr><td><img src="images/install_step_1.png" title='Step 1' alt="Open the Optional installs package"/></td><td><img src="images/install_step_2.png" title='Step 2' alt="Click continue in the welcome screen"/></td></tr>
      <tr><td><img src="images/install_step_3.png" title='Step 3' alt="Click continue at the license agreement"/></td><td><img src="images/install_step_4.png" title='Step 4' alt="Agree to the license"/></td></tr>
      <tr><td><img src="images/install_step_5.png" title='Step 5' alt="Select your boot disk - usually 'MacIntosh HD"/></td><td><img src="images/install_step_6.png" title='Step 6' alt="Select X11 from the list of applications to install"/></td></tr>
      </table>
</div>
<hr /><a id="autoinst"></a><h2>FSL Install Script</h2>
<p>An automated installer, <a href="fsl_installer.sh">fsl_installer.sh</a> is available to carry out the installation. In addition it will install FSLView into /Applications, automatically configure your environment to enable you to run FSL and to allow the launching of X11 applications from within the Apple Terminal application. Finally, if you use <i>Matlab</i> it will configure your <i>startup.m</i> file to allow you to use the FSL Matlab functions.
</p>
<h3>Running the installer</h3>
<p>
Once you have downloaded the installer, open a <i>Terminal</i> (look in the <i>Utilities</i> folder in <i>Applications</i>), change to the folder containing the downloaded file (for example if you downloaded to your Desktop):</p>
<pre>cd ~/Desktop</pre>
<p>
 and run it with:
</p>
<pre>sh fsl_installer.sh</pre>
<p>
Assuming that this folder also contains the FSL distribution tar file and you wish to install into <i>/usr/local</i> then just press Return when the installer asks a question, to accept the defaults. Be aware that you may need Administrator priviledges to install into certain folders on your computer - <i>/usr/local</i> being an example, the installer will ask for your password if necessary to allow this.
</p>
<p>
For more information on controlling the installer, run it with the <i>-h</i> option.
</p>
<hr /><a id="maninst"></a><h2>Manual Installation</h2>
<ol>
  <li> Unpack the FSL distribution
    <ul>
      <li> Open up a <i>Terminal</i> (you can find this application in <i>Utilities</i> folder inside the <i>Applications</i> folder).</li>
      <li> In the terminal, change to the directory where you want FSL installed, e.g.
	<pre>cd /usr/local</pre>
      </li>
      <li> Unpack the fsl download file - for example, if you downloaded it onto your Desktop,
	<pre>tar -zxvf ~/Desktop/fsl-*-macosx*.tar.gz</pre>
	(omit the z in the -zxvf if your computer has already uncompressed the tarfile for you).
	This will create a directory called fsl in the current directory which will contain all the required files for FSL and FSLView. Note that you might need to add <i>sudo</i> to the start of the tar command if you don't automatically have the right to create files in <i>/usr/local</i>. 
      </li>
    </ul>
    </li>
  <li> Install the applications
  <ul>
  <li>
    To get a clickable application icon FSLView, open a file browser in the toplevel <i>fsl</i> directory, e.g.
    <pre>open /usr/local/fsl</pre>
    and drag the <i>fslview.app</i> directory into your <i>Applications</i> folder or your Desktop.
  </li>
  <li> Find out which shell you are running.
    In a terminal, type:
    <pre>help</pre>
    the output will be either a list of commands, in which case you are using the bash shell, or an error saying &quot;command not found&quot; or similar message, in which case you are using the tcsh or csh shell.
  </li>
  </ul>
  </li>
  <li> Set up your user environment.
    If you are using the bash shell (the default) then do the following -
    <ul>
      <li> In a running terminal type:
	<pre>cd 
touch .bash_profile
open -a TextEdit .bash_profile</pre>
	This will bring up a TextEdit window
      </li>
      <li> Select Make Plain Text from the Format menu if it is available (if only Make Rich Text is there then do nothing as it is already in plain text mode) </li>
      <li> In the window type the following lines at the end of the document (or better still, use copy and paste to do this):
	<pre>FSLDIR=/usr/local/fsl
. ${FSLDIR}/etc/fslconf/fsl.sh
PATH=${FSLDIR}/bin:${PATH}
export FSLDIR PATH
	
if [ -z "$DISPLAY" -a "X$TERM_PROGRAM" = "XApple_Terminal" ]; then
  X11_FOLDER=/tmp/.X11-unix
  currentUser=`id -u`
  userX11folder=`find $X11_FOLDER -name 'X*' -user $currentUser -print 2>&amp;1 | tail -n 1`
  if [ -n "$userX11folder" ]; then
    displaynumber=`basename ${userX11folder} | grep -o '[[:digit:]]\+'`
    if [ -n "$displaynumber" ]; then
      DISPLAY=localhost:${displaynumber}
      export DISPLAY
    else
      echo "Warning: DISPLAY not configured as X11 is not running"
    fi
  else
    echo "Warning: DISPLAY not configured as X11 is not running"
  fi
fi</pre>
      Note that the second line starts with a dot (i.e. full stop or period), then a space, then <i>${FSLDIR}/etc/fslconf/fsl.sh</i> - <b>the dot and space are very important!</b></li>
    <li> Change the line <i>FSLDIR=/usr/local/fsl</i> and replace <i>/usr/local/fsl</i> with the directory name of the place where you installed FSL.</li>
    <li> Save the file and exit TextEdit </li>
    </ul>
  <p>
  If you are using the tcsh or the csh shell then follow the above instructions, but instead type the following in the terminal:
 </p>
  <pre>cd 
touch .cshrc
open -a TextEdit .cshrc</pre>
  and add the following to the <i>.cshrc</i> file (as opened in TextEdit, but after selecting plain text mode - as above):
  <pre>setenv FSLDIR /usr/local/fsl
source ${FSLDIR}/etc/fslconf/fsl.csh
setenv PATH ${FSLDIR}/bin:${PATH}
if ( "X$DISPLAY" == "X" &amp;&amp; "X$TERM_PROGRAM" == "XApple_Terminal" )  then
  set X11_FOLDER=/tmp/.X11-unix
  set currentUser=`id -u`
  set userX11folder=`find $X11_FOLDER -name 'X*' -user $currentUser -print 2>&amp;1 | tail -n 1`
  if ( "X$userX11folder" != "X" ) then
    set displaynumber=`basename ${userX11folder} | grep -o '[[:digit:]]\+'`
    if ( "X$displaynumber" != "X" ) then
      setenv DISPLAY localhost:${displaynumber}
    else
      echo "Warning: DISPLAY not configured as X11 is not running"
    endif
  else
    echo "Warning: DISPLAY not configured as X11 is not running"
  endif   
endif</pre>
  then change the <i>/usr/local/fsl</i> as instructed above, and save the file.
</li>
</ol>
<hr /><a id="checkinst"></a><h2>Checking the installation</h2>
<p>
  Test that the environment and command line tools are set up correctly by doing the following:
</p>
<ul>
  <li> Quit the Terminal program and start it again </li>
  <li> Check that your environment is correct by typing:
    <pre>echo $FSLDIR</pre>
    This should display the name of the directory that you installed FSL in.
  </li>
  <li> Check that your path is correct by typing:
    <pre>flirt -version</pre>
    which should display a line like:
    <pre>FLIRT version 5.4.2</pre>
    (although the version number might be different). 
  </li>
</ul>
<p>
In general, to run the FSL tools from the command line (within a terminal) you need to enter the program name in lower case (e.g. <i>bet</i>). Typing a command on its own (without any arguments or options) gives you a help message for that command.
</p>
<p>
A more complete test of the FSL installation can be run at this point
by using the testing and evaluation suite <a href="feeds.html">FEEDS</a>.
</p>
<hr /><a id="gui"></a><h2>Running the GUIs</h2>
<p>
Once you have checked the environment and command line programs, as described above, then start <i>X11</i> (click on it in the <i>Utilities</i> folder inside the <i>Applications</i> folder) . All of the FSL GUIs should now work. To run a GUI version of a program you can either type its capitalised name with an additional '_gui' appended in the terminal (e.g. <i>Bet_gui</i>), or you can start the main FSL GUI by just typing <i>fsl</i>.
</p>

<hr /><a id="matlab"></a><h2>Using Matlab libraries</h2>
<p>FSL ships with several Matlab scripts for loading Analyze files. These libraries are dependant on FSL environment variables which aren't set in the Mac OS X Desktop environment, so won't run in a Matlab session started from the /Applications/MATLAB.app launcher. There are two options:
</p>
<ol>
<li>Run Matlab from a correctly configured Terminal (assuming Matlab 7.4 - adjust as appropriate for your version)
  <pre>/Applications/MATLAB74/bin/matlab</pre>
or
</li>
<li>Configure the FSL environment variable in your ~/matlab/startup.m file - add the following (assuming FSL installed in /usr/local):
  <pre>setenv( 'FSLDIR', '/usr/local/fsl');
fsldir = getenv('FSLDIR');
fsldirmpath = sprintf('%s/etc/matlab',fsldir);
path(path, fsldirmpath);
clear fsldir fsldirmpath;</pre>
</li>
</ol>
<hr /><a id="fhelp"></a><h2>Further help</h2>
<p>If any problems occur when installing or running the FSL tools, please consult the FSL FAQ. This also contains instructions on how to join and use the FSL email list to ask specific questions which are not covered in the FAQ.
</p>
</body>
</html>

#!/bin/sh
# preinst script for arno-iptables-firewall

set -e

# Move a conffile. In case of an unmodified file simply
# remove it to not trigger dpkg questions.
# However, if the file is modified this question should occur.
mv_conffile() 
{
    CONFFILE="$1"
    NEWLOCATION="$2"

    if [ -e "$CONFFILE" ]; then
        md5sum="`md5sum \"$CONFFILE\" | sed -e \"s/ .*//\"`"
        old_md5sum=$(dpkg-query -W -f='${Conffiles}' arno-iptables-firewall | grep ${CONFFILE} | awk '{ print $2 }')
        if [ "$md5sum" = "$old_md5sum" ]; then
            rm -f "$CONFFILE"
        else
            mv "$CONFFILE" "$NEWLOCATION"
        fi
    fi
}

case "$1" in
    install|upgrade)
        if dpkg --compare-versions "$2" le "3.3.11-2"; then
            if [ -e /etc/fsl/fsl.conf ]; then
                echo "Moving old FSL configuration to /etc/fsl/fsl.sh."
            
                if [ ! -d /etc/fsl ]; then 
                    mkdir /etc/fsl
                fi
            
                mv_conffile "/etc/fsl/fsl.conf" "/etc/fsl/fsl.sh"
            fi	
        fi
    ;;

    abort-upgrade)
    ;;

    *)
        echo "preinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0


